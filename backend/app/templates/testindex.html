{% extends "base.html" %}

{% block content %}
  <h1>Hi, {{ user.username }}!</h1>
  {% for post in posts %}
  <div><p>{{ post.author.username }} says: <b>{{ post.body }}</b></p></div>
  {% endfor %}

  <div class="container">
    <h1>Flask React</h1>
    <br>
    <div id="main"></div>
  </div>

  <!-- <div id="map" style="width:840px; height: 400px;"></div> -->
  <br>
  <div id="myDiv"></div>
  <div style="height: 100px;">
    
  </div>

  <script>
    // var map;
    // function initMap() {
    //   map = new google.maps.Map(document.getElementById('map'), {
    //     center: {lat: 51.33901, lng: -113.76666},
    //     zoom: 10
    //   });
    // }
    function whenAvailable(name, callback) {
        var interval = 10; // ms
        window.setTimeout(function() {
            if (window[name]) {
                callback(window[name]);
            } else {
                window.setTimeout(arguments.callee, interval);
            }
        }, interval);
    }
    whenAvailable("Plotly", function(t) {
    Plotly.d3.csv(
      'https://raw.githubusercontent.com/plotly/datasets/master/2015_06_30_precipitation.csv',
      function(err, rows){
        function unpack(rows, key) {
            return rows.map(function(row) { return row[key]; });
        }

        scl = [[0, 'rgb(150,0,90)'],[0.125, 'rgb(0, 0, 200)'],[0.25,'rgb(0, 25, 255)'],[0.375,'rgb(0, 152, 255)'],[0.5,'rgb(44, 255, 150)'],[0.625,'rgb(151, 255, 0)'],[0.75,'rgb(255, 234, 0)'],[0.875,'rgb(255, 111, 0)'],[1,'rgb(255, 0, 0)']];

        console.log(unpack(rows, 'Globvalue'));
        var data = [{
            type: 'scattergeo',
            mode: 'markers',
            text: unpack(rows, 'Globvalue'),
            lon: unpack(rows, 'Lon'),
            lat: unpack(rows, 'Lat'),
            marker: {
              color: unpack(rows, 'Globvalue'),
              colorscale: scl,
              cmin: 0,
              cmax: 1.4,
              reversescale: true,
              opacity: 0.2,
              size: 2,
              colorbar:{
                thickness: 10,
                titleside: 'right',
                outlinecolor: 'rgba(68,68,68,0)',
                ticks: 'outside',
                ticklen: 3,
                shoticksuffix: 'last',
                ticksuffix: 'inches',
                dtick: 0.1
              }
            },
            name: 'NA Precipitation'
        }];

    var layout = {
      geo:{
        scope: 'north america',
        showland: true,
        landcolor: 'rgb(212,212,212)',
        subunitcolor: 'rgb(255,255,255)',
        countrycolor: 'rgb(255,255,255)',
        showlakes: true,
        lakecolor: 'rgb(255,255,255)',
        showsubunits: true,
        showcountries: true,
        resolution: 50,
        projection: {
          type: 'conic conformal',
          rotation: {
            long: -100
          }
        },
        lonaxis: {
          showgrid: true,
          gridwidth: 0.5,
          range: [ -140.0, -55.0 ],
          dtick: 5
        },
        lataxis: {
          showgrid: true,
          gridwidth: 0.5,
          range: [ 20.0, 60.0 ],
          dtick: 5
        },
      },

      title: 'North America Precipitation',
      width: 600,
      height: 600
    };

    Plotly.newPlot('myDiv', data, layout, {showSendToCloud: true});
  });
  });
  </script>
{% endblock %}